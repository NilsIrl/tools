<!doctype html><html>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Nils' Toolbox - PGP Symmetrical Encryption/Decryption Online</title>
</head>
<body>
<a href=https://tools.nilsand.re/><h1>Nils' Toolbox</h1></a>
<nav>
<ul>
<li><a href=https://tools.nilsand.re/handoutify/>Handoutify</a></li><li><a href=https://tools.nilsand.re/pgp-symmetrical/>PGP Symmetrical Encryption/Decryption Online</a></li>
</ul>
</nav>
<h2>PGP Symmetrical Encryption/Decryption Online</h2>
<form id=form>
<input type=file name=file id=file required>
<div>
<label for=key>Symmetric key: </label>
<input type=password id=key name=key required>
</div>
<div>
<input type=radio name=action value=decrypt id=decryptChoice checked>
<label for=decryptChoice>Decrypt</label>
</div>
<div>
<input type=radio name=action value=encrypt id=encryptChoice>
<label for=encryptChoice>Encrypt</label>
</div>
<input type=submit>
</form>
<script type=module>
    import * as openpgp from 'https://unpkg.com/openpgp@5.0.0-6/dist/openpgp.min.mjs';
    let form = document.getElementById("form");
    form.addEventListener('submit', event => {
        event.preventDefault();
        let password = document.getElementById("key").value;
        let reader = new FileReader();
        let decryptChoice = document.getElementById("decryptChoice").checked;
        let file = document.getElementById("file").files[0];
        reader.onload = async (e) => {
            const a = document.createElement("a");
            let data;
            let filename;
            if (decryptChoice) {
                const message = await openpgp.readMessage({ armoredMessage: e.target.result });
                const decryptedMessage = await openpgp.decrypt({ message: message, passwords: password, format: "binary" });
                data = decryptedMessage.data;
                filename = decryptedMessage.filename;
            } else {
                const message = await openpgp.createMessage({ text: e.target.result, filename: file.name, date: file.lastModified });
                const encryptedMessage = await openpgp.encrypt({ message: message, passwords: password });
                data = encryptedMessage;
                filename = file.name + ".pgp";
                console.log(encryptedMessage);
            }
            const url = window.URL.createObjectURL(new Blob([data]));
            a.href = url;
            a.style.display = "none";
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            a.remove();
        }
        reader.readAsBinaryString(file);
    });
</script>
<footer>
<a href=https://github.com/NilsIrl/tools>Source code</a>
<p>&copy; 2021 Nils Andr√©</p>
</footer>
</body>
</html>